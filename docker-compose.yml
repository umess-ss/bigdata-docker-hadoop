# Remove version: line (obsolete warning)

services:
  namenode:
    image: apache/hadoop:3
    container_name: namenode
    hostname: namenode
    ports:
      - 9870:9870
      - 8020:8020
    volumes:
      - namenode:/hadoop/dfs/name
      - ./config:/opt/hadoop/etc/hadoop:ro   # your XML configs here
    # Add environment or command if needed
    user: root
    command: hdfs namenode

  datanode:
    image: apache/hadoop:3
    container_name: datanode
    hostname: datanode
    ports:
      - 9864:9864
    volumes:
      - datanode:/hadoop/dfs/data
      - ./config:/opt/hadoop/etc/hadoop:ro
    depends_on:
      - namenode
    user: root
    command: hdfs datanode

  resourcemanager:
    image: apache/hadoop:3
    container_name: resourcemanager
    hostname: resourcemanager
    ports:
      - 8088:8088
    volumes:
      - ./config:/opt/hadoop/etc/hadoop:ro
    depends_on:
      - namenode
      - datanode
    command: yarn resourcemanager

  nodemanager:
    image: apache/hadoop:3
    container_name: nodemanager
    hostname: nodemanager
    ports:
      - 8042:8042
    volumes:
      - ./config:/opt/hadoop/etc/hadoop:ro
    depends_on:
      - resourcemanager
    command: yarn nodemanager

  historyserver:
    image: apache/hadoop:3
    container_name: historyserver
    hostname: historyserver
    user: root
    command: bash -c "mkdir -p /opt/hadoop/logs && mapred --daemon start historyserver && sleep 5 && tail -f /opt/hadoop/logs/*.log || tail -f /dev/null"
    ports:
      - "8188:8188"
      - "19888:19888"
    volumes:
      - hadoop_historyserver:/hadoop/yarn/timeline
      - ./config:/opt/hadoop/etc/hadoop:ro
      - hadoop_history_logs:/opt/hadoop/logs
    depends_on:
      - resourcemanager

volumes:
  namenode:
  datanode:
  hadoop_history_logs:
  hadoop_historyserver: